# Generated by Django 4.2.5 on 2025-11-11 09:40

from django.db import migrations, models
import django.db.models.deletion

from commcare_connect.program.utils import populate_currency_and_country_fk_for_model


# Compiled from https://github.com/datasets/country-codes
#   and https://github.com/datasets/currency-codes/
#   which in turn are sourced from ISO data source
COUNTRIES = [
    # ISO3166-1-Alpha-3, Name, ISO4217-currency_alphabetic_code
    ("AFG", "Afghanistan", "AFN"),
    ("ALA", "Åland Islands", "EUR"),
    ("ALB", "Albania", "ALL"),
    ("DZA", "Algeria", "DZD"),
    ("ASM", "American Samoa", "USD"),
    ("AND", "Andorra", "EUR"),
    ("AGO", "Angola", "AOA"),
    ("AIA", "Anguilla", "XCD"),
    ("ATA", "Antarctica", None),
    ("ATG", "Antigua and Barbuda", "XCD"),
    ("ARG", "Argentina", "ARS"),
    ("ARM", "Armenia", "AMD"),
    ("ABW", "Aruba", "AWG"),
    ("AUS", "Australia", "AUD"),
    ("AUT", "Austria", "EUR"),
    ("AZE", "Azerbaijan", "AZN"),
    ("BHS", "Bahamas", "BSD"),
    ("BHR", "Bahrain", "BHD"),
    ("BGD", "Bangladesh", "BDT"),
    ("BRB", "Barbados", "BBD"),
    ("BLR", "Belarus", "BYN"),
    ("BEL", "Belgium", "EUR"),
    ("BLZ", "Belize", "BZD"),
    ("BEN", "Benin", "XOF"),
    ("BMU", "Bermuda", "BMD"),
    ("BTN", "Bhutan", "BTN"),
    ("BOL", "Bolivia (Plurinational State of)", "BOB"),
    ("BES", "Bonaire, Sint Eustatius and Saba", "USD"),
    ("BIH", "Bosnia and Herzegovina", "BAM"),
    ("BWA", "Botswana", "BWP"),
    ("BVT", "Bouvet Island", "NOK"),
    ("BRA", "Brazil", "BRL"),
    ("IOT", "British Indian Ocean Territory", "USD"),
    ("VGB", "British Virgin Islands", "USD"),
    ("BRN", "Brunei Darussalam", "BND"),
    ("BGR", "Bulgaria", "BGN"),
    ("BFA", "Burkina Faso", "XOF"),
    ("BDI", "Burundi", "BIF"),
    ("CPV", "Cabo Verde", "CVE"),
    ("KHM", "Cambodia", "KHR"),
    ("CMR", "Cameroon", "XAF"),
    ("CAN", "Canada", "CAD"),
    ("CYM", "Cayman Islands", "KYD"),
    ("CAF", "Central African Republic", "XAF"),
    ("TCD", "Chad", "XAF"),
    ("CHL", "Chile", "CLP"),
    ("CHN", "China", "CNY"),
    ("HKG", "China, Hong Kong Special Administrative Region", "HKD"),
    ("MAC", "China, Macao Special Administrative Region", "MOP"),
    ("CXR", "Christmas Island", "AUD"),
    ("CCK", "Cocos (Keeling) Islands", "AUD"),
    ("COL", "Colombia", "COP"),
    ("COM", "Comoros", "KMF"),
    ("COG", "Congo", "XAF"),
    ("COK", "Cook Islands", "NZD"),
    ("CRI", "Costa Rica", "CRC"),
    ("HRV", "Croatia", "EUR"),
    ("CUB", "Cuba", "CUP"),
    ("CUW", "Curaçao", "XCG"),
    ("CYP", "Cyprus", "EUR"),
    ("CZE", "Czechia", "CZK"),
    ("PRK", "Democratic People's Republic of Korea", "KPW"),
    ("COD", "Democratic Republic of the Congo", "CDF"),
    ("DNK", "Denmark", "DKK"),
    ("DJI", "Djibouti", "DJF"),
    ("DMA", "Dominica", "XCD"),
    ("DOM", "Dominican Republic", "DOP"),
    ("ECU", "Ecuador", "USD"),
    ("EGY", "Egypt", "EGP"),
    ("SLV", "El Salvador", "SVC"),
    ("GNQ", "Equatorial Guinea", "XAF"),
    ("ERI", "Eritrea", "ERN"),
    ("EST", "Estonia", "EUR"),
    ("SWZ", "Eswatini", "SZL"),
    ("ETH", "Ethiopia", "ETB"),
    ("FLK", "Falkland Islands", "FKP"),
    ("FRO", "Faroe Islands", "DKK"),
    ("FJI", "Fiji", "FJD"),
    ("FIN", "Finland", "EUR"),
    ("FRA", "France", "EUR"),
    ("GUF", "French Guiana", "EUR"),
    ("PYF", "French Polynesia", "XPF"),
    ("ATF", "French Southern Territories", "EUR"),
    ("GAB", "Gabon", "XAF"),
    ("GMB", "Gambia", "GMD"),
    ("GEO", "Georgia", "GEL"),
    ("DEU", "Germany", "EUR"),
    ("GHA", "Ghana", "GHS"),
    ("GIB", "Gibraltar", "GIP"),
    ("GRC", "Greece", "EUR"),
    ("GRL", "Greenland", "DKK"),
    ("GRD", "Grenada", "XCD"),
    ("GLP", "Guadeloupe", "EUR"),
    ("GUM", "Guam", "USD"),
    ("GTM", "Guatemala", "GTQ"),
    ("GGY", "Guernsey", "GBP"),
    ("GIN", "Guinea", "GNF"),
    ("GNB", "Guinea-Bissau", "XOF"),
    ("GUY", "Guyana", "GYD"),
    ("HTI", "Haiti", "HTG"),
    ("HMD", "Heard Island and McDonald Islands", "AUD"),
    ("VAT", "Holy See", "EUR"),
    ("HND", "Honduras", "HNL"),
    ("HUN", "Hungary", "HUF"),
    ("ISL", "Iceland", "ISK"),
    ("IND", "India", "INR"),
    ("IDN", "Indonesia", "IDR"),
    ("IRN", "Iran (Islamic Republic of)", "IRR"),
    ("IRQ", "Iraq", "IQD"),
    ("IRL", "Ireland", "EUR"),
    ("IMN", "Isle of Man", "GBP"),
    ("ISR", "Israel", "ILS"),
    ("ITA", "Italy", "EUR"),
    ("CIV", "Ivory Coast", "XOF"),
    ("JAM", "Jamaica", "JMD"),
    ("JPN", "Japan", "JPY"),
    ("JEY", "Jersey", "GBP"),
    ("JOR", "Jordan", "JOD"),
    ("KAZ", "Kazakhstan", "KZT"),
    ("KEN", "Kenya", "KES"),
    ("KIR", "Kiribati", "AUD"),
    ("KWT", "Kuwait", "KWD"),
    ("KGZ", "Kyrgyzstan", "KGS"),
    ("LAO", "Lao People's Democratic Republic", "LAK"),
    ("LVA", "Latvia", "EUR"),
    ("LBN", "Lebanon", "LBP"),
    ("LSO", "Lesotho", "LSL"),
    ("LBR", "Liberia", "LRD"),
    ("LBY", "Libya", "LYD"),
    ("LIE", "Liechtenstein", "CHF"),
    ("LTU", "Lithuania", "EUR"),
    ("LUX", "Luxembourg", "EUR"),
    ("MDG", "Madagascar", "MGA"),
    ("MWI", "Malawi", "MWK"),
    ("MYS", "Malaysia", "MYR"),
    ("MDV", "Maldives", "MVR"),
    ("MLI", "Mali", "XOF"),
    ("MLT", "Malta", "EUR"),
    ("MHL", "Marshall Islands", "USD"),
    ("MTQ", "Martinique", "EUR"),
    ("MRT", "Mauritania", "MRU"),
    ("MUS", "Mauritius", "MUR"),
    ("MYT", "Mayotte", "EUR"),
    ("MEX", "Mexico", "MXN"),
    ("FSM", "Micronesia (Federated States of)", "USD"),
    ("MCO", "Monaco", "EUR"),
    ("MNG", "Mongolia", "MNT"),
    ("MNE", "Montenegro", "EUR"),
    ("MSR", "Montserrat", "XCD"),
    ("MAR", "Morocco", "MAD"),
    ("MOZ", "Mozambique", "MZN"),
    ("MMR", "Myanmar", "MMK"),
    ("NAM", "Namibia", "NAD"),
    ("NRU", "Nauru", "AUD"),
    ("NPL", "Nepal", "NPR"),
    ("NLD", "Netherlands", "EUR"),
    ("NCL", "New Caledonia", "XPF"),
    ("NZL", "New Zealand", "NZD"),
    ("NIC", "Nicaragua", "NIO"),
    ("NER", "Niger", "XOF"),
    ("NGA", "Nigeria", "NGN"),
    ("NIU", "Niue", "NZD"),
    ("NFK", "Norfolk Island", "AUD"),
    ("MNP", "Northern Mariana Islands", "USD"),
    ("MKD", "North Macedonia", "MKD"),
    ("NOR", "Norway", "NOK"),
    ("OMN", "Oman", "OMR"),
    ("PAK", "Pakistan", "PKR"),
    ("PLW", "Palau", "USD"),
    ("PAN", "Panama", "PAB"),
    ("PNG", "Papua New Guinea", "PGK"),
    ("PRY", "Paraguay", "PYG"),
    ("PER", "Peru", "PEN"),
    ("PHL", "Philippines", "PHP"),
    ("PCN", "Pitcairn", "NZD"),
    ("POL", "Poland", "PLN"),
    ("PRT", "Portugal", "EUR"),
    ("PRI", "Puerto Rico", "USD"),
    ("QAT", "Qatar", "QAR"),
    ("KOR", "Republic of Korea", "KRW"),
    ("MDA", "Republic of Moldova", "MDL"),
    ("REU", "Réunion", "EUR"),
    ("ROU", "Romania", "RON"),
    ("RUS", "Russian Federation", "RUB"),
    ("RWA", "Rwanda", "RWF"),
    ("BLM", "Saint Barthélemy", "EUR"),
    ("SHN", "Saint Helena", "SHP"),
    ("KNA", "Saint Kitts and Nevis", "XCD"),
    ("LCA", "Saint Lucia", "XCD"),
    ("MAF", "Saint Martin (French Part)", "EUR"),
    ("SPM", "Saint Pierre and Miquelon", "EUR"),
    ("VCT", "Saint Vincent and the Grenadines", "XCD"),
    ("WSM", "Samoa", "WST"),
    ("SMR", "San Marino", "EUR"),
    ("STP", "Sao Tome and Principe", "STN"),
    ("SAU", "Saudi Arabia", "SAR"),
    ("SEN", "Senegal", "XOF"),
    ("SRB", "Serbia", "RSD"),
    ("SYC", "Seychelles", "SCR"),
    ("SLE", "Sierra Leone", "SLE"),
    ("SGP", "Singapore", "SGD"),
    ("SXM", "Sint Maarten (Dutch part)", "XCG"),
    ("SVK", "Slovakia", "EUR"),
    ("SVN", "Slovenia", "EUR"),
    ("SLB", "Solomon Islands", "SBD"),
    ("SOM", "Somalia", "SOS"),
    ("ZAF", "South Africa", "ZAR"),
    ("SGS", "South Georgia and the South Sandwich Islands", None),
    ("SSD", "South Sudan", "SSP"),
    ("ESP", "Spain", "EUR"),
    ("LKA", "Sri Lanka", "LKR"),
    ("PSE", "State of Palestine", None),
    ("SDN", "Sudan", "SDG"),
    ("SUR", "Suriname", "SRD"),
    ("SJM", "Svalbard and Jan Mayen Islands", "NOK"),
    ("SWE", "Sweden", "SEK"),
    ("CHE", "Switzerland", "CHF"),
    ("SYR", "Syrian Arab Republic", "SYP"),
    ("TWN", "Taiwan", "TWD"),
    ("TJK", "Tajikistan", "TJS"),
    ("THA", "Thailand", "THB"),
    ("TLS", "Timor-Leste", "USD"),
    ("TGO", "Togo", "XOF"),
    ("TKL", "Tokelau", "NZD"),
    ("TON", "Tonga", "TOP"),
    ("TTO", "Trinidad and Tobago", "TTD"),
    ("TUN", "Tunisia", "TND"),
    ("TUR", "Turkey", "TRY"),
    ("TKM", "Turkmenistan", "TMT"),
    ("TCA", "Turks and Caicos Islands", "USD"),
    ("TUV", "Tuvalu", "AUD"),
    ("UGA", "Uganda", "UGX"),
    ("UKR", "Ukraine", "UAH"),
    ("ARE", "United Arab Emirates", "AED"),
    ("GBR", "United Kingdom of Great Britain and Northern Ireland", "GBP"),
    ("TZA", "United Republic of Tanzania", "TZS"),
    ("UMI", "United States Minor Outlying Islands", "USD"),
    ("USA", "United States of America", "USD"),
    ("VIR", "United States Virgin Islands", "USD"),
    ("URY", "Uruguay", "UYU"),
    ("UZB", "Uzbekistan", "UZS"),
    ("VUT", "Vanuatu", "VUV"),
    ("VEN", "Venezuela (Bolivarian Republic of)", "VES"),
    ("VNM", "Viet Nam", "VND"),
    ("WLF", "Wallis and Futuna Islands", "XPF"),
    ("ESH", "Western Sahara", "MAD"),
    ("YEM", "Yemen", "YER"),
    ("ZMB", "Zambia", "ZMW"),
    ("ZWE", "Zimbabwe", "ZWG"),
]


CURRENCIES = [
    # Name, ISO4217-currency_alphabetic_code
    ("Afghani", "AFN"),
    ("Euro", "EUR"),
    ("Lek", "ALL"),
    ("Algerian Dinar", "DZD"),
    ("US Dollar", "USD"),
    ("Kwanza", "AOA"),
    ("East Caribbean Dollar", "XCD"),
    ("Argentine Peso", "ARS"),
    ("Armenian Dram", "AMD"),
    ("Aruban Florin", "AWG"),
    ("Australian Dollar", "AUD"),
    ("Azerbaijan Manat", "AZN"),
    ("Bahamian Dollar", "BSD"),
    ("Bahraini Dinar", "BHD"),
    ("Taka", "BDT"),
    ("Barbados Dollar", "BBD"),
    ("Belarusian Ruble", "BYN"),
    ("Belize Dollar", "BZD"),
    ("CFA Franc BCEAO", "XOF"),
    ("Bermudian Dollar", "BMD"),
    ("Indian Rupee", "INR"),
    ("Ngultrum", "BTN"),
    ("Boliviano", "BOB"),
    ("Mvdol", "BOV"),
    ("Convertible Mark", "BAM"),
    ("Pula", "BWP"),
    ("Norwegian Krone", "NOK"),
    ("Brazilian Real", "BRL"),
    ("Brunei Dollar", "BND"),
    ("Bulgarian Lev", "BGN"),
    ("Burundi Franc", "BIF"),
    ("Cabo Verde Escudo", "CVE"),
    ("Riel", "KHR"),
    ("CFA Franc BEAC", "XAF"),
    ("CFP Franc", "XPF"),
    ("Canadian Dollar", "CAD"),
    ("Cayman Islands Dollar", "KYD"),
    ("Chilean Peso", "CLP"),
    ("Unidad de Fomento", "CLF"),
    ("Yuan Renminbi", "CNY"),
    ("Colombian Peso", "COP"),
    ("Unidad de Valor Real", "COU"),
    ("Comorian Franc", "KMF"),
    ("Congolese Franc", "CDF"),
    ("New Zealand Dollar", "NZD"),
    ("Costa Rican Colon", "CRC"),
    ("Cuban Peso", "CUP"),
    ("Caribbean Guilder", "XCG"),
    ("Czech Koruna", "CZK"),
    ("Danish Krone", "DKK"),
    ("Djibouti Franc", "DJF"),
    ("Dominican Peso", "DOP"),
    ("Egyptian Pound", "EGP"),
    ("El Salvador Colon", "SVC"),
    ("Nakfa", "ERN"),
    ("Lilangeni", "SZL"),
    ("Ethiopian Birr", "ETB"),
    ("Falkland Islands Pound", "FKP"),
    ("Fiji Dollar", "FJD"),
    ("Dalasi", "GMD"),
    ("Lari", "GEL"),
    ("Ghana Cedi", "GHS"),
    ("Gibraltar Pound", "GIP"),
    ("Quetzal", "GTQ"),
    ("Pound Sterling", "GBP"),
    ("Guinean Franc", "GNF"),
    ("Guyana Dollar", "GYD"),
    ("Gourde", "HTG"),
    ("Lempira", "HNL"),
    ("Hong Kong Dollar", "HKD"),
    ("Forint", "HUF"),
    ("Iceland Krona", "ISK"),
    ("Rupiah", "IDR"),
    ("Iranian Rial", "IRR"),
    ("Iraqi Dinar", "IQD"),
    ("New Israeli Sheqel", "ILS"),
    ("Jamaican Dollar", "JMD"),
    ("Yen", "JPY"),
    ("Jordanian Dinar", "JOD"),
    ("Tenge", "KZT"),
    ("Kenyan Shilling", "KES"),
    ("North Korean Won", "KPW"),
    ("Won", "KRW"),
    ("Kuwaiti Dinar", "KWD"),
    ("Som", "KGS"),
    ("Lao Kip", "LAK"),
    ("Lebanese Pound", "LBP"),
    ("Loti", "LSL"),
    ("Rand", "ZAR"),
    ("Liberian Dollar", "LRD"),
    ("Libyan Dinar", "LYD"),
    ("Swiss Franc", "CHF"),
    ("Pataca", "MOP"),
    ("Denar", "MKD"),
    ("Malagasy Ariary", "MGA"),
    ("Malawi Kwacha", "MWK"),
    ("Malaysian Ringgit", "MYR"),
    ("Rufiyaa", "MVR"),
    ("Ouguiya", "MRU"),
    ("Mauritius Rupee", "MUR"),
    ("Mexican Peso", "MXN"),
    ("Mexican Unidad de Inversion (UDI)", "MXV"),
    ("Moldovan Leu", "MDL"),
    ("Tugrik", "MNT"),
    ("Moroccan Dirham", "MAD"),
    ("Mozambique Metical", "MZN"),
    ("Kyat", "MMK"),
    ("Namibia Dollar", "NAD"),
    ("Nepalese Rupee", "NPR"),
    ("Cordoba Oro", "NIO"),
    ("Naira", "NGN"),
    ("Rial Omani", "OMR"),
    ("Pakistan Rupee", "PKR"),
    ("Balboa", "PAB"),
    ("Kina", "PGK"),
    ("Guarani", "PYG"),
    ("Sol", "PEN"),
    ("Philippine Peso", "PHP"),
    ("Zloty", "PLN"),
    ("Qatari Rial", "QAR"),
    ("Romanian Leu", "RON"),
    ("Russian Ruble", "RUB"),
    ("Rwanda Franc", "RWF"),
    ("Saint Helena Pound", "SHP"),
    ("Tala", "WST"),
    ("Dobra", "STN"),
    ("Saudi Riyal", "SAR"),
    ("Serbian Dinar", "RSD"),
    ("Seychelles Rupee", "SCR"),
    ("Leone", "SLE"),
    ("Singapore Dollar", "SGD"),
    ("Solomon Islands Dollar", "SBD"),
    ("Somali Shilling", "SOS"),
    ("South Sudanese Pound", "SSP"),
    ("Sri Lanka Rupee", "LKR"),
    ("Sudanese Pound", "SDG"),
    ("Surinam Dollar", "SRD"),
    ("Swedish Krona", "SEK"),
    ("Syrian Pound", "SYP"),
    ("New Taiwan Dollar", "TWD"),
    ("Somoni", "TJS"),
    ("Tanzanian Shilling", "TZS"),
    ("Baht", "THB"),
    ("Pa'anga", "TOP"),
    ("Trinidad and Tobago Dollar", "TTD"),
    ("Tunisian Dinar", "TND"),
    ("Turkish Lira", "TRY"),
    ("Turkmenistan New Manat", "TMT"),
    ("Uganda Shilling", "UGX"),
    ("Hryvnia", "UAH"),
    ("UAE Dirham", "AED"),
    ("Peso Uruguayo", "UYU"),
    ("Uruguay Peso en Unidades Indexadas (UI)", "UYI"),
    ("Unidad Previsional", "UYW"),
    ("Uzbekistan Sum", "UZS"),
    ("Vatu", "VUV"),
    ("Bolívar Soberano", "VES"),
    ("Dong", "VND"),
    ("Moroccan Dirham", "MAD"),
    ("Yemeni Rial", "YER"),
    ("Zambian Kwacha", "ZMW"),
    ("Zimbabwe Gold", "ZWG"),
]


def load_currency_and_country_data(apps, schema_editor):
    Currency = apps.get_model("opportunity", "Currency")
    Country = apps.get_model("opportunity", "Country")

    currency_objs = []
    for name, code in CURRENCIES:
        currency_objs.append(
            Currency(
                code=code,
                name=name,
                is_valid=True,
            )
        )

    Currency.objects.bulk_create(currency_objs, ignore_conflicts=True)

    code_to_currency = {
        c.code: c
        for c in Currency.objects.filter(code__in=[code for _, code in CURRENCIES])
    }

    country_objs = []
    for code, name, currency_code in COUNTRIES:
        country_objs.append(
            Country(
                code=code,
                name=name,
                currency=code_to_currency.get(currency_code),
            )
        )

    Country.objects.bulk_create(country_objs, ignore_conflicts=True)



def populate_currency_and_country_fk(apps, schema_editor):
    populate_currency_and_country_fk_for_model(apps, "Opportunity", "opportunity", "opportunity")


class Migration(migrations.Migration):
    dependencies = [
        ("opportunity", "0086_labsrecord_program_alter_labsrecord_opportunity"),
    ]

    operations = [
        migrations.CreateModel(
            name="Currency",
            fields=[
                ("code", models.CharField(max_length=3, primary_key=True, serialize=False)),
                ("name", models.CharField(max_length=64)),
                ("is_valid", models.BooleanField(default=True)),
            ],
        ),
        migrations.CreateModel(
            name="Country",
            fields=[
                ("code", models.CharField(max_length=3, primary_key=True, serialize=False)),
                ("name", models.CharField(max_length=128)),
                (
                    "currency",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="opportunity.currency"
                    ),
                ),
            ],
        ),
        migrations.AddField(
            model_name="opportunity",
            name="currency_fk",
            field=models.ForeignKey(
                null=True, on_delete=django.db.models.deletion.DO_NOTHING, to="opportunity.currency"
            ),
        ),
        migrations.AddField(
            model_name="opportunity",
            name="country",
            field=models.ForeignKey(
                null=True, on_delete=django.db.models.deletion.DO_NOTHING, to="opportunity.country"
            ),
        ),
        migrations.RunPython(
            load_currency_and_country_data,
            reverse_code=migrations.RunPython.noop,
            # No need to run since the rows can get replicated
            hints={"run_on_secondary": False},
        ),
        migrations.RunPython(
            populate_currency_and_country_fk,
            reverse_code=migrations.RunPython.noop,
            # No need to run since the rows will get auto replicated
            hints={"run_on_secondary": False},
        ),
    ]
